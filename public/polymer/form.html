<dom-module id="lucinda-form">
  <template>
    <form is="iron-form" id="form" on-iron-form-presubmit="presubmit">
      <paper-input name="title" label="Title"></paper-input>
      <paper-autocomplete id="expedition" on-autocomplete-selected="selectedExpeditionValue" on-autocomplete-change="autocompleteExpedition" name="expedition" label="Expedition" remote-source="true" length="2"></paper-autocomplete>
      <paper-input name="dates" label="Dates"></paper-input>
      <paper-input name="creator" label="Creator"></paper-input>
      <paper-input name="locale" label="Where"></paper-input>
      <paper-textarea name="notes" label="Notes"></paper-textarea>
      <paper-input name="current_location" label="Current Location"></paper-input>

      <paper-button raised on-tap="submitForm">Submit</paper-button>
    </form>
  </template>

  <script>
    Polymer({
      is: 'lucinda-form',
      presubmit: function() {
        var params = this.$.form.request.params;
        params.selectedExpedition = this.selectedExpedition;
        // saved value to look at post request
        // TODO add any changes to request parameters here
      },
      submitForm: function(e) {
        this.$.form.submit();
      },
      selectedExpeditionValue: function(e, selected) {
        this.selectedExpedition = selected.value;
      },
      autocompleteExpedition: function(e) {
        var input = this.$.expedition;
        var search = input.text;
        var url = '/expedition/search?q=' + search;
        var req= new XMLHttpRequest();
        req.open('GET', encodeURI(url));
        req.onload = function() {
          if (req.status === 200) {
            var data = JSON.parse(req.response);
            var arr = data.map(function(obj) {
              return {text: obj.text, value: obj.id };
            });
            input.suggestions(arr);
          }
        };
        req.send();
      }
    });
  </script>
</dom-module>
